# mishka_ai/handlers/admin_commands/general_admin_commands.py
"""
–ú–æ–¥—É–ª—å —Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏ –æ–±—â–∏—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö –∫–æ–º–∞–Ω–¥.

–≠—Ç–∏ –∫–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª—è—é—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º –±–æ—Ç–∞.
"""
import logging
from telegram import Update, constants
from telegram.ext import ContextTypes
from telegram.helpers import escape_markdown

logger = logging.getLogger(__name__)

async def toggle_bot_active_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /toggle_bot_active.

    –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –±–æ—Ç–∞ (–≤–∫–ª/–≤—ã–∫–ª). –í –≤—ã–∫–ª—é—á–µ–Ω–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
    –±–æ—Ç –Ω–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –æ–±—ã—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã
    –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.

    –î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –±–æ—Ç–∞.
    """
    user_id_str = str(update.effective_user.id)
    admin_user_id = context.bot_data.get("admin_user_id")

    # –ü—Ä–æ–≤–µ—Ä–∫–∞, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å –∫–æ–º–∞–Ω–¥—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
    if not admin_user_id or user_id_str != admin_user_id:
        await update.message.reply_text("–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –±–æ—Ç–∞.")
        return

    # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –∏–∑ bot_data –∏ –∏–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –µ–≥–æ
    current_status = context.bot_data.get("is_bot_active", True)
    new_status = not current_status
    context.bot_data["is_bot_active"] = new_status

    # –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
    status_text = "üü¢ *–ê–ö–¢–ò–í–ï–ù*" if new_status else "üî¥ *–ü–†–ò–û–°–¢–ê–ù–û–í–õ–ï–ù (PAUSED)*"
    await update.message.reply_text(
        f"–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã –∏–∑–º–µ–Ω–µ–Ω. –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å: {status_text}\n"
        f"–í —Ä–µ–∂–∏–º–µ –ø–∞—É–∑—ã –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω. –î–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.",
        parse_mode=constants.ParseMode.MARKDOWN
    )
    logger.info(f"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä {update.effective_user.full_name} –∏–∑–º–µ–Ω–∏–ª —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã –Ω–∞: {'–∞–∫—Ç–∏–≤–µ–Ω' if new_status else '–ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω'}")